---
# Bring stack down

  - hosts: loadbalancer
    become: true
    tasks:
    - name: stop nginx service
      service: name=nginx state=stopped
    
    - name: configure system language
      command: localectl set-locale LANG=en_US.UTF-8
      notify: reboot nginx server
      
    - name: install pre-requisites
      yum:
        name: "{{ packages }}"
        state: present
        update_cache: yes
      vars:
        packages:
          - wget
          - links
          - python-httplib2
     
    - name: configure proxy environment
      copy: 
        dest: "/etc/profile.d/proxy.sh"
        mode: 0774
        owner: root
        group: root
        content: |
          export http_proxy=http://127.0.0.1:3128
          export https_proxy=$http_proxy
          no_proxy=vm-centos-7-*,192.168.235.100,192.168.235.101,192.168.235.102,192.168.235.103,192.168.235.104,192.168.235.105,192.168.235.106,192.168.235.107,192.168.235.108,192.168.235.109,192.168.235.110,192.168.235.111,192.168.235.112,192.168.235.113,192.168.235.114,192.168.235.115,192.168.235.116,192.168.235.117,192.168.235.118,192.168.235.119,192.168.235.120,192.168.235.121,192.168.235.122,192.168.235.123,192.168.235.124,192.168.235.125,192.168.235.126,192.168.235.127,192.168.235.128,192.168.235.129,192.168.235.130,192.168.235.131,192.168.235.132,192.168.235.133,192.168.235.134,192.168.235.135,192.168.235.136,192.168.235.137,192.168.235.138,192.168.235.139,192.168.235.140,192.168.235.141,192.168.235.142,192.168.235.143,192.168.235.144,192.168.235.145,192.168.235.146,192.168.235.147,192.168.235.148,192.168.235.149,192.168.235.150,127.0.0.1,localhost,scopus.com.br"
      notify: reboot nginx server
      
    handlers:
    - name: reboot nginx server
      reboot:
        test_command: mount
#----------------------------        
  - hosts: webserver
    become: true
    tasks: 
    - name: stop httpd service
      service: name=httpd state=stopped

    - name: configure system language
      command: localectl set-locale LANG=en_US.UTF-8
      notify: reboot httpd server
      
    - name: install pre-requisites
      yum:
        name: "{{ packages }}"
        state: present
        update_cache: yes
      vars:
        packages:
          - wget
          - links
          - python-httplib2
      
    - name: configure proxy environment
      copy: 
        dest: "/etc/profile.d/proxy.sh"
        mode: 0774
        owner: root
        group: root
        content: |
          export http_proxy=http://127.0.0.1:3128
          export https_proxy=$http_proxy
          no_proxy=vm-centos-7-*,192.168.235.100,192.168.235.101,192.168.235.102,192.168.235.103,192.168.235.104,192.168.235.105,192.168.235.106,192.168.235.107,192.168.235.108,192.168.235.109,192.168.235.110,192.168.235.111,192.168.235.112,192.168.235.113,192.168.235.114,192.168.235.115,192.168.235.116,192.168.235.117,192.168.235.118,192.168.235.119,192.168.235.120,192.168.235.121,192.168.235.122,192.168.235.123,192.168.235.124,192.168.235.125,192.168.235.126,192.168.235.127,192.168.235.128,192.168.235.129,192.168.235.130,192.168.235.131,192.168.235.132,192.168.235.133,192.168.235.134,192.168.235.135,192.168.235.136,192.168.235.137,192.168.235.138,192.168.235.139,192.168.235.140,192.168.235.141,192.168.235.142,192.168.235.143,192.168.235.144,192.168.235.145,192.168.235.146,192.168.235.147,192.168.235.148,192.168.235.149,192.168.235.150,127.0.0.1,localhost,scopus.com.br"
          
    handlers:
    - name: reboot httpd server
      reboot:
        test_command: mount
#----------------------------
  - hosts: database
    become: true
    
    tasks: 
    - name: stop mariadb service
      service: name=mariadb state=stopped
      notify: reboot mariadb server
      
    - name: configure system language
      command: localectl set-locale LANG=en_US.UTF-8
      notify: reboot mariadb server
      
    - name: install pre-requisites
      yum:
        name: "{{ packages }}"
        state: present
        update_cache: yes
      vars:
        packages:
          - wget
          - links
          - python-httplib2
      
    - name: configure proxy environment
      copy: 
        dest: "/etc/profile.d/proxy.sh"
        mode: 0774
        owner: root
        group: root
        content: |
          export http_proxy=http://127.0.0.1:3128
          export https_proxy=$http_proxy
          no_proxy=vm-centos-7-*,192.168.235.100,192.168.235.101,192.168.235.102,192.168.235.103,192.168.235.104,192.168.235.105,192.168.235.106,192.168.235.107,192.168.235.108,192.168.235.109,192.168.235.110,192.168.235.111,192.168.235.112,192.168.235.113,192.168.235.114,192.168.235.115,192.168.235.116,192.168.235.117,192.168.235.118,192.168.235.119,192.168.235.120,192.168.235.121,192.168.235.122,192.168.235.123,192.168.235.124,192.168.235.125,192.168.235.126,192.168.235.127,192.168.235.128,192.168.235.129,192.168.235.130,192.168.235.131,192.168.235.132,192.168.235.133,192.168.235.134,192.168.235.135,192.168.235.136,192.168.235.137,192.168.235.138,192.168.235.139,192.168.235.140,192.168.235.141,192.168.235.142,192.168.235.143,192.168.235.144,192.168.235.145,192.168.235.146,192.168.235.147,192.168.235.148,192.168.235.149,192.168.235.150,127.0.0.1,localhost,scopus.com.br"
      
    handlers:
    - name: reboot mariadb server
      reboot:
        test_command: mount
  
  #localectl set-locale LANG=en_US.UTF-8
  
  